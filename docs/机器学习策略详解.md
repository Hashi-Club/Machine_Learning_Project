# 机器学习策略详解 (XGBoost)

## 1. 策略概述
本策略使用 **XGBoost (eXtreme Gradient Boosting)** 算法，基于历史市场数据和技术指标来预测下一个交易日的股价涨跌方向。

## 2. 数据准备与特征工程
策略使用以下特征作为模型的输入：

### 基础行情数据
- **Open, High, Low, Close, Volume**: 基础的量价数据。

### 技术指标
- **移动平均线 (MA)**: MA5, MA10, MA20，用于捕捉短期和中期趋势。
- **相对强弱指数 (RSI)**: RSI14，用于衡量超买超卖状态。
- **MACD指标**: DIF, DEA, MACD柱，用于捕捉动量变化。
- **布林带 (Bollinger Bands)**: Upper, Lower，用于衡量波动性和价格相对位置。
- **平均真实波幅 (ATR)**: ATR14，用于衡量市场波动率。

### 滞后特征 (Lag Features)
为了让模型学习到时间序列的模式，我们对关键变量（收盘价、成交量、RSI、MACD柱）及其变化率（Return）构建了滞后特征（Lag 1 到 Lag 5）。这使得模型不仅看到当前的状态，还能看到过去5天的状态演变。

## 3. 模型训练目标
- **预测目标**: 下一个交易日的收盘价是否高于当日收盘价。
- **标签 (Label)**: 
  - `1` (上涨): $Close_{t+1} > Close_t$
  - `0` (下跌或持平): $Close_{t+1} \le Close_t$
- **训练集**: 使用 2024-01-01 之前的数据进行训练。
- **测试/回测**: 使用 2024-01-01 之后的数据进行策略验证。

## 4. 交易信号生成与阈值调整
模型输出的是样本属于类别 `1` (上涨) 的概率 $P(Up)$。

### 原始逻辑
- 当 $P(Up) > 0.55$ 时，生成买入/持有信号 (Signal = 1)。
- 否则，生成卖出/空仓信号 (Signal = 0)。

### 调整后的逻辑 (考虑手续费)
考虑到实际交易中存在 **印花税、佣金和平台费**（特别是港股市场的最低佣金和平台费限制），频繁交易或在微弱优势下交易会导致亏损。
因此，我们将买入阈值从 `0.55` 提高到 `0.60`。

- **新规则**: 只有当模型预测上涨的概率 **超过 60%** 时，才认为上涨的可信度足以覆盖交易成本，从而执行买入操作。
- **效果**: 这会减少交易频率，过滤掉那些模型信心不足的交易机会，从而提高单次交易的胜率和盈亏比。

## 5. 优势与局限
- **优势**: 能够利用非线性关系和多因子交互来捕捉市场规律；通过提高阈值可以有效控制回撤和成本。
- **局限**: 机器学习模型容易在历史数据上过拟合；市场风格切换时模型可能失效；高阈值可能导致错过部分上涨行情。
