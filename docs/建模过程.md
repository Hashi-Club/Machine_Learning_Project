# 建模过程

本文档详细描述了针对腾讯控股 (00700.HK) 的投资策略建模过程，包括问题定义、数据处理、策略构建、成本模型及评估体系。

## 1. 问题定义

* **投资标的**：腾讯控股 (00700.HK)
* **初始资金**：100,000 HKD
* **投资周期**：
  * **训练期**（用于机器学习模型）：2018年1月1日 - 2023年12月31日
  * **回测/测试期**：2024年1月1日 - 2025年4月24日
* **目标**：在控制风险（最大回撤）的前提下，追求超越“买入并持有”策略的超额收益。

## 2. 数据准备与特征工程

我们使用包含开盘价、最高价、最低价、收盘价、成交量 (OHLCV) 的日线数据，并计算了以下技术指标作为模型输入：

* **趋势指标**：移动平均线 (MA5, MA10, MA20), MACD (DIF, DEA, BAR)
* **动量指标**：相对强弱指数 (RSI14)
* **波动率指标**：布林带 (Upper, Lower, Mid), ATR14
* **滞后特征**：为了捕捉时间序列模式，我们为机器学习模型构建了过去 5 天的滞后特征 (Lag Features)，包括收盘价、成交量、RSI 和 MACD 的历史值。

## 3. 策略模型

我们构建了两类策略进行对比分析：

### 3.1 传统技术分析策略

* **双均线交叉 (MA Cross)**：
  * **逻辑**：短期均线 (MA5) 上穿长期均线 (MA20) 时买入，下穿时卖出。
  * **假设**：价格趋势具有惯性。
* **RSI 均值回归 (RSI Reversion)**：
  * **逻辑**：RSI < 30 (超卖) 买入，RSI > 70 (超买) 卖出。
  * **假设**：价格过度偏离后会回归均值。
* **布林带突破 (Bollinger Breakout)**：
  * **逻辑**：价格突破布林带上轨买入，跌破下轨卖出。
  * **假设**：突破波动率边界意味着新趋势的开始。

### 3.2 机器学习策略 (XGBoost)

* **模型**：梯度提升决策树 (XGBoost Classifier)。
* **预测目标**：预测下一个交易日的收盘价是否上涨 (二分类问题)。
* **输入特征**：上述所有技术指标及其滞后值。
* **交易逻辑**：
  * 当模型预测上涨概率 > 0.55 时，产生买入/持有信号。
  * 否则，产生卖出/空仓信号。
* **训练方式**：使用 2018-2023 年数据训练，在 2024-2025 年数据上进行回测，避免未来函数。

## 4. 交易与成本模型

为了模拟真实的港股交易环境，我们实施了严格的交易约束和成本计算。

### 4.1 交易约束

1. **最小交易单位**：1手 = 100股。所有交易指令必须是100股的整数倍。
2. **做空限制**：本模型仅支持做多 (Long Only)，不允许卖空。
3. **资金限制**：买入金额不能超过当前可用现金。

### 4.2 交易成本 (港股)

手续费参考富途证券标准 (固定式套餐)，具体构成如下：

1. **佣金 (Commission)**：交易金额的 0.03%，最低 3 HKD。
2. **平台使用费 (Platform Fee)**：每笔订单固定 15 HKD。
3. **印花税 (Stamp Duty)**：交易金额的 0.1%，不足 1 HKD 按 1 HKD 计 (向上取整)。
4. **交易费 (Trading Fee)**：交易金额的 0.00565%，最低 0.01 HKD。
5. **证监会征费 (SFC Levy)**：交易金额的 0.0027%，最低 0.01 HKD。
6. **会财局征费 (FRC Levy)**：交易金额的 0.00015%。
7. **结算交收费 (Settlement Fee)**：交易金额的 0.0042%，最低 2 HKD，最高 100 HKD。

*注：系统使用费已于 2023 年取消，模型中根据日期自动判断是否收取。*

## 5. 回测与评估指标

回测框架按日逐行处理数据，模拟真实的订单执行过程。主要评估指标包括：

* **累计收益率 (Total Return)**：期末权益 / 初始资金 - 1。
* **年化收益率 (CAGR)**：考虑复利的年化回报。
* **最大回撤 (Max Drawdown)**：资产净值从峰值下跌的最大幅度，衡量风险。
* **夏普比率 (Sharpe Ratio)**：超额收益与波动率的比值，衡量风险调整后收益。
* **胜率 (Win Rate)**：盈利交易次数占比。
